<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polling Averages Table</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400..700;1,400..700&family=Inconsolata:wght@200..900&display=swap');

        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            text-align: left;
            padding: 8px;
        }
        td{
            border-bottom: 1px solid rgb(34, 34, 34);
            font-family: 'Inconsolata';

        }
        td:nth-child(1){
            font-weight: bold;
            font-family: 'Arimo';
        }
        th {
            font-family: 'Arimo';
            background-color: #ffffff;
            border-bottom: 2px solid rgb(34, 34, 34);
        }
        th.sort-asc::after {
            content: " ▲";
            font-size: 5pt;
        }
        th.sort-desc::after {
            content: " ▼";
            font-size: 5pt;

        }
    </style>
</head>
<body>

<div id="polling-table"></div>


<script>
    // Load data from CSV file
    d3.csv("state_averages.csv").then(function(pollingData) {

        // Create the table element
        const table = d3.select("#polling-table").append("table");

        // Create the table header
        const thead = table.append("thead");
        const headers = thead.append("tr")
            .selectAll("th")
            .data(["State", "Margin","Harris","Trump"])
            .enter()
            .append("th")
            .text(d => d)
            .on("click", function(d, i) {
                // Sort the table when a header is clicked
                const isAscending = d3.select(this).classed("sort-asc");
                headers.classed("sort-asc", false).classed("sort-desc", false);
                d3.select(this).classed(isAscending ? "sort-desc" : "sort-asc", true);
                sortTable(i, !isAscending);
            });

        // Create the table body
        const tbody = table.append("tbody");

        // Function to update the rows
        function updateRows(data) {
            const rows = tbody.selectAll("tr")
                .data(data)
                .join("tr");

            rows.selectAll("td")
                .data(d => [d.State, d.Margin,d.Dem,d.GOP])
                .join("td")
                .text(d => d)
                .style("color", (d, i) => {
                    if (i === 1) { // Polling Average column
                        const value = +d;
                        if (value > 0) {
                            return "blue";
                        } else if (value < 0) {
                            return "red";
                        } else {
                            return "red";
                        }
                    }
                    return null;
                });
        }

        // Initial table population
        updateRows(pollingData);

        // Sort the table data
        function sortTable(index, ascending) {
            pollingData.sort((a, b) => {
                if (index === 0) {  // Sort by Candidate
                    return ascending ? d3.ascending(a.State, b.State) : d3.descending(a.State, b.State);
                } else {  // Sort by Polling Average
                    return ascending ? d3.ascending(+a.Margin, +b.Margin) : d3.descending(+a.Margin, +b.Margin);
                }
            });
            updateRows(pollingData);
        }

    }).catch(function(error) {
        console.error('Error loading the CSV file:', error);
    });

</script>


</body>
</html>
